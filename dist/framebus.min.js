"use strict";!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):n.framebus=t()}(this,function(){function n(n){var t,r={};for(t in l)l.hasOwnProperty(t)&&(r[t]=l[t]);return r._origin=n||"*",r}function t(n){var t,r,e=this._origin||"*";return"string"!=typeof n?!1:"string"!=typeof e?!1:(r=Array.prototype.slice.call(arguments,1),t=i(n,r,e),t===!1?!1:(c(p.top,t,e),!0))}function r(n,t){var r=this._origin||"*";return x(n,t,r)?!1:(y[r]=y[r]||{},y[r][n]=y[r][n]||[],y[r][n].push(t),!0)}function e(n,t){var r,e,i=this._origin||"*";if(x(n,t,i))return!1;if(e=y[i]&&y[i][n],!e)return!1;for(r=0;r<e.length;r++)if(e[r]===t)return e.splice(r,1),!0;return!1}function i(n,t,r){var e=!1,i={event:n},o=t[t.length-1];"function"==typeof o&&(i.reply=g(o,r),t=t.slice(0,-1)),i.args=t;try{e=JSON.stringify(i)}catch(u){throw new Error("Could not stringify event: "+u.message)}return e}function o(n){var t,r,e,o;try{t=JSON.parse(n.data)}catch(u){return!1}return null==t.event?!1:(null!=t.reply&&(r=n.origin,e=n.source,o=t.reply,t.reply=function(n){var t=i(o,[n],r);return t===!1?!1:(e.postMessage(t,r),void 0)},t.args.push(t.reply)),t)}function u(n){p||(p=n,p.addEventListener?p.addEventListener("message",a,!1):p.attachEvent?p.attachEvent("onmessage",a):null===p.onmessage?p.onmessage=a:p=null)}function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=16*Math.random()|0,r="x"===n?t:3&t|8;return r.toString(16)})}function a(n){var t;"string"==typeof n.data&&(t=o(n),t&&(f("*",t.event,t.args,n),f(n.origin,t.event,t.args,n)))}function f(n,t,r,e){var i;if(y[n]&&y[n][t])for(i=0;i<y[n][t].length;i++)y[n][t][i].apply(e,r)}function c(n,t,r){var e;for(n.postMessage(t,r),e=0;e<n.frames.length;e++)c(n.frames[e],t,r)}function g(n,t){function r(i,o){n(i,o),l.target(t).unsubscribe(e,r)}var e=s();return l.target(t).subscribe(e,r),e}function x(n,t,r){return"string"!=typeof n?!0:"function"!=typeof t?!0:"string"!=typeof r?!0:!1}var p,l,y={};return u(window),l={target:n,publish:t,pub:t,trigger:t,emit:t,subscribe:r,sub:r,on:r,unsubscribe:e,unsub:e,off:e}});