"use strict";!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):n.framebus=t()}(this,function(){function n(n){var t,e={};for(t in v)v.hasOwnProperty(t)&&(e[t]=v[t]);return e._origin=n||"*",e}function t(n,t){var e,r=this._origin||"*";return"string"!=typeof n?!1:"string"!=typeof r?!1:(e=i(n,t,r),e===!1?!1:(c(p.top,e,r),!0))}function e(n,t){var e=this._origin||"*";return g(n,t,e)?!1:(d[e]=d[e]||{},d[e][n]=d[e][n]||[],d[e][n].push(t),!0)}function r(n,t){var e,r,i=this._origin||"*";if(g(n,t,i))return!1;if(r=d[i]&&d[i][n],!r)return!1;for(e=0;e<r.length;e++)if(r[e]===t)return r.splice(e,1),!0;return!1}function i(n,t,e){var r=!1,i={event:n};"function"==typeof t?i.reply=x(t,e):i.data=t;try{r=JSON.stringify(i)}catch(o){throw new Error("Could not stringify event: "+o.message)}return r}function o(n){var t,e,r;try{t=JSON.parse(n.data)}catch(o){return!1}return null==t.event?!1:(null!=t.reply&&(e=n.origin,r=n.source,t.data=function(n){var o=i(t.reply,n,e);return o===!1?!1:(r.postMessage(o,e),void 0)}),t)}function u(n){p||(p=n,p.addEventListener?p.addEventListener("message",s,!1):p.attachEvent?p.attachEvent("onmessage",s):null===p.onmessage?p.onmessage=s:p=null)}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=16*Math.random()|0,e="x"===n?t:3&t|8;return e.toString(16)})}function s(n){var t;"string"==typeof n.data&&(t=o(n),t&&(f("*",t.event,t.data,n.origin),f(n.origin,t.event,t.data,n.origin)))}function f(n,t,e,r){var i;if(d[n]&&d[n][t])for(i=0;i<d[n][t].length;i++)d[n][t][i](e,r)}function c(n,t,e){var r;for(n.postMessage(t,e),r=0;r<n.frames.length;r++)c(n.frames[r],t,e)}function x(n,t){function e(i,o){n(i,o),v.target(t).unsubscribe(r,e)}var r=a();return v.target(t).subscribe(r,e),r}function g(n,t,e){return"string"!=typeof n?!0:"function"!=typeof t?!0:"string"!=typeof e?!0:!1}var p,v,d={};return u(window),v={target:n,publish:t,pub:t,trigger:t,emit:t,subscribe:e,sub:e,on:e,unsubscribe:r,unsub:r,off:r}});